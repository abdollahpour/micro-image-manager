<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>micro-image-manager</title>
    <meta name="description" content="micro-image-manager test endpoint" />
    <meta name="author" content="Hamed Abdollahpour" />

    <meta property="og:title" content="micro-image-manager" />
    <meta property="og:type" content="website" />
    <meta
      property="og:url"
      content="https://github.com/abdollahpour/micro-image-manager"
    />
    <meta
      property="og:description"
      content="micro-image-manager test endpoint"
    />
    <meta property="og:image" content="image.png" />

    <link rel="icon" href="data:," />
    <style>
      .form-set {
        margin: 1em;
      }
      .container {
        margin: 1em;
      }
    </style>
  </head>

  <body>
    <form
      action="/api/v1/images"
      method="post"
      enctype="multipart/form-data"
      id="form"
    >
      <div class="form-set">
        <label for="image">Image:</label>
        <input name="image" type="file" id="image" />
      </div>
      <div class="form-set">
        <label for="small">Small:</label>
        <input name="profile_small" value="400x300" id="small" />
      </div>
      <div class="form-set">
        <label for="large">Large:</label>
        <input name="profile_large" value="800x600" id="large" />
      </div>
      <div class="form-set">
        <button type="submit">Send!</button>
      </div>
    </form>
    <div id="container"></div>
    <script>
      var form = document.getElementById("form");
      var container = document.getElementById("container");

      form.onsubmit = function (e) {
        e.preventDefault();

        var xhr = new XMLHttpRequest();
        var data = new FormData(form);

        xhr.onload = function () {
          var json = JSON.parse(this.responseText);

          const arrays = json.formats.map((format) =>
            json.profiles.map(
              (profile) =>
                `
                  <div class="image_container">
                    <p>Profile: ${profile.name} Format: ${format} Size: ${profile.width}x${profile.height}</p>
                    <img src="/image/${json.id}.${format}?profile=${profile.name}" />
                  </div>
                `
            )
          );
          container.innerHTML = [].concat.apply([], arrays).join("");
        };

        xhr.open("post", form.action);
        xhr.send(data);
      };
    </script>
  </body>
</html>
